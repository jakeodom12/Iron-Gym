<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="robots" content="noindex, nofollow">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#09090b">
    <title>The Iron Garage</title>
    
    <!-- Tech Stack: Tailwind CSS & Lucide Icons -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Tailwind Configuration -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        zinc: {
                            850: '#1f1f22',
                            900: '#18181b',
                            950: '#09090b',
                        },
                        iron: {
                            red: '#dc2626', // Red-600
                            dark: '#09090b',
                            surface: '#27272a', // Zinc-800
                            emerald: '#10b981',
                            blue: '#3b82f6',
                            amber: '#f59e0b',
                        }
                    },
                    fontFamily: {
                        sans: ['-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', 'sans-serif'],
                    },
                    spacing: {
                        'safe-top': 'env(safe-area-inset-top)',
                        'safe-bottom': 'env(safe-area-inset-bottom)',
                    }
                }
            }
        }
    </script>

    <style>
        /* iOS Optimization & Custom Scrollbars */
        body {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            user-select: none;
            background-color: #09090b; /* Zinc-950 */
        }
        
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Smooth tab transitions */
        .tab-active {
            border-bottom: 2px solid #dc2626;
            color: #f4f4f5; /* Zinc-100 */
        }
        .tab-active-rebuild {
            border-bottom: 2px solid #10b981; /* Emerald-500 */
            color: #f4f4f5;
        }
        .tab-active-tonic {
            border-bottom: 2px solid #3b82f6; /* Blue-500 */
            color: #f4f4f5;
        }
        .tab-active-ruck {
            border-bottom: 2px solid #f59e0b; /* Amber-500 */
            color: #f4f4f5;
        }
        .tab-inactive {
            border-bottom: 2px solid transparent;
            color: #71717a; /* Zinc-500 */
        }

        /* Checkbox Animation */
        .checkbox-wrapper input:checked + div {
            background-color: #dc2626;
            border-color: #dc2626;
        }
        .checkbox-wrapper input:checked + div svg {
            display: block;
        }
        
        /* Rebuild specific checkbox */
        .checkbox-wrapper-rebuild input:checked + div {
            background-color: #10b981;
            border-color: #10b981;
        }
        .checkbox-wrapper-rebuild input:checked + div svg {
            display: block;
        }

         /* Tonic specific checkbox */
         .checkbox-wrapper-tonic input:checked + div {
            background-color: #3b82f6;
            border-color: #3b82f6;
        }
        .checkbox-wrapper-tonic input:checked + div svg {
            display: block;
        }
        
        /* Ruck specific checkbox */
         .checkbox-wrapper-ruck input:checked + div {
            background-color: #f59e0b;
            border-color: #f59e0b;
        }
        .checkbox-wrapper-ruck input:checked + div svg {
            display: block;
        }
    </style>
</head>
<body class="bg-zinc-950 text-zinc-100 h-screen w-screen overflow-hidden flex flex-col font-sans">

    <!-- App Content Wrapper -->
    <div id="app" class="flex-1 flex flex-col h-full relative">
        <!-- Rendered via JS -->
    </div>

    <!-- JavaScript Data & Logic -->
    <script>
        // --- 1. DATA ARCHITECTURE ---
        
        const APP_BUILD_DATE = "Jan 13, 2026 - 7:09 PM MST";

        const INVENTORY = {
            kbs: {
                pairs: [20, 24, 32], // kg
                singles: [28, 44]    // kg
            },
            barbell: true,
            machines: ['Assault Runner', 'Reverse Hyper', 'Pull-up Bar', 'Sled']
        };

        const WARMUP_ROUTINE = [
            { title: "1. Meditation", desc: "1-Minute One-Moment Meditation. Sit quietly, close eyes, and count your breaths." },
            { title: "2. Mobility", desc: "Hang from a bar for 30 seconds (decompress spine) + Sit in the bottom of a Goblet Squat for 30 seconds (open hips)." },
            { title: "3. Review", desc: "Check your training journal and review your 'Compass' (Work, Rest, Play, Pray balance)." },
            { title: "4. Compass Points", desc: "Ensure you are not neglecting Work, Rest, Play, or Pray/Spiritual health." },
            { title: "5. Warm-up Sets", desc: "Perform 1 light set of each: Overhead Press, Row, Hinge (Swing/Deadlift), Overhead Squat, and a Carry." }
        ];

        // Standard Workouts (Randomizable)
        const WORKOUTS = {
            grind: [
                {
                    id: 'es-classic',
                    title: 'Easy Strength Classic',
                    desc: 'The fundamental 40-day protocol. Ideally performed 5 days a week. Never miss a rep, never fail, leave fresh.',
                    equipment: 'Barbell, Pull-up Bar',
                    difficulty: 'beginner',
                    protocol: 'Perform 2 sets of 5 reps for each movement. Warm up, do the work, put weights away. Do not seek fatigue.',
                    movements: [
                        'Whole Body: Deadlift OR Kettlebell Swing (2x5)',
                        'Push: Overhead Press OR Bench Press (2x5)',
                        'Pull: Pull-up OR Barbell Row (2x5)',
                        'Hinge/Squat: Front Squat OR Goblet Squat (2x5)',
                        'Loaded Carry: Farmer Walk (Distance varies)'
                    ],
                    rounds: 1
                },
                {
                    id: 'reg-park-5x5',
                    title: 'Reg Park 5x5',
                    desc: 'The grandfather of all strength programs. Simple, effective, and brutal if rushed.',
                    equipment: 'Barbell',
                    difficulty: 'beginner',
                    protocol: 'Perform 2 warm-up sets, then 3 "working" sets of 5 reps. Rest 3-5 minutes between working sets.',
                    movements: [
                        'Back Squat: 5 sets of 5 reps',
                        'Chin-ups: 5 sets of 5 reps',
                        'Dip OR Bench Press: 5 sets of 5 reps',
                        'Deadlift: 5 sets of 5 reps',
                        'Barbell Curl: 3 sets of 10 reps'
                    ],
                    rounds: 1
                },
                {
                    id: 'abf-press-day',
                    title: 'ABF: Press Day',
                    desc: 'The Yin to the ABC Yang. Heavy volume pressing day from the Armor Building Formula.',
                    equipment: 'Double KBs or Barbell',
                    difficulty: 'intermediate',
                    protocol: 'Focus on Military Press volume. Ladders mean you do 2 reps, rest, 3 reps, rest, 5 reps. That is one ladder.',
                    movements: [
                        'Double Military Press: Ladders of 2-3-5',
                        'Pull-ups: Match the sets/reps of the Press',
                        'Goblet Squats: Light sets to stay loose'
                    ],
                    rounds: 5
                },
                 {
                    id: 'abf-break-in',
                    title: 'ABF: Hypertrophy Break-In',
                    desc: 'A Barbell mass building phase for those new to Armor Building.',
                    equipment: 'Barbell',
                    difficulty: 'beginner',
                    protocol: 'Classic bodybuilding sets and reps. Focus on technique and the "squeeze".',
                    movements: [
                        'Clean & Press: 5 sets of 8 reps',
                        'Barbell Curl: 3-5 sets of 8 reps',
                        'Squat: 3 sets of 10 reps (optional)'
                    ],
                    rounds: 1
                },
                {
                    id: 'southwood',
                    title: 'Southwood Program',
                    desc: 'Classic 4 days/week strength builder. Great for off-season athletes.',
                    equipment: 'Barbell',
                    difficulty: 'intermediate',
                    protocol: 'Perform 8 reps, add weight, 6 reps, add weight, 4 reps. Do this for all lifts. When you complete all reps with good form, add weight next time.',
                    movements: [
                        'Power Clean: 8-6-4 reps',
                        'Military Press: 8-6-4 reps',
                        'Front Squat: 8-6-4 reps',
                        'Bench Press: 8-6-4 reps'
                    ],
                    rounds: 1
                },
                {
                    id: 'rop-heavy',
                    title: 'Rite of Passage (Heavy)',
                    desc: 'The classic ladder press program.',
                    equipment: 'Single KB',
                    difficulty: 'advanced',
                    protocol: 'Clean & Press Ladders (1-2-3-4-5). Rest as needed. Finish with high volume swings.',
                    movements: [
                        'C&P Ladders: 1, 2, 3, 4, 5 reps per side',
                        'Weighted Pull-ups: 1, 2, 3, 4, 5 reps',
                        'Finisher: Roll dice for minutes of Snatches/Swings'
                    ],
                    rounds: 5
                },
                {
                    id: 'paschall-classic',
                    title: 'The Paschall One-Set',
                    desc: 'Old school bodybuilding. One heavy set of 16-20 reps. Brutal but short.',
                    equipment: 'Barbell',
                    difficulty: 'intermediate',
                    protocol: 'Perform exactly 1 set of 16-20 reps for each movement. Go close to failure.',
                    movements: [
                        'Overhead Squat',
                        'Barbell Curl',
                        'Deadlift + Shrug (at top)',
                        'Incline Bench Press',
                        'Triceps Extension',
                        'Back Squat',
                        'Upright Row'
                    ],
                    rounds: 1
                },
                {
                    id: 'breathing-squat',
                    title: 'Breathing Squat Complex',
                    desc: 'Systemic hypertrophy. Uses deep breathing to expand the rib cage.',
                    equipment: 'Barbell',
                    difficulty: 'intermediate',
                    protocol: '3 Sets. Squats are immediately followed by light Pullovers to stretch the rib cage.',
                    movements: [
                        'Breathing Squats: 15-20 reps (3 deep breaths between reps)',
                        'Straight Arm Pullovers: 15-20 reps (light weight)',
                        'Bench Press (interspersed)',
                        'Curls (interspersed)'
                    ],
                    rounds: 3
                },
                {
                    id: 'complex-a',
                    title: 'Barbell Complex A',
                    desc: '"Wrestler Strength". High capacity work for collision athletes.',
                    equipment: 'Barbell',
                    difficulty: 'advanced',
                    protocol: '8 reps each movement. The bar does NOT touch the ground until the entire round is over.',
                    movements: [
                        'Bent Over Row: 8 reps',
                        'Power Clean: 8 reps',
                        'Front Squat: 8 reps',
                        'Military Press: 8 reps',
                        'Back Squat: 8 reps',
                        'Good Mornings: 8 reps'
                    ],
                    rounds: 5
                }
            ],
            ballistic: [
                {
                    id: 'humane-burpee',
                    title: 'Humane Burpee',
                    desc: 'Volume descends, heart rate ascends.',
                    equipment: 'Kettlebell',
                    difficulty: 'intermediate',
                    protocol: '15 Swings, then a ladder of Goblet Squats and Pushups (5 reps, then 4, 3, 2, 1).',
                    movements: [
                        '15 KB Swings',
                        'Goblet Squats (5, 4, 3, 2, 1)',
                        'Pushups (5, 4, 3, 2, 1)',
                        'Repeat pattern: 15 Swings between every ladder rung.'
                    ],
                    rounds: 5
                },
                {
                    id: 'eagle',
                    title: 'The Eagle',
                    desc: 'A signature challenge. "So simple, so hard."',
                    equipment: 'Double KBs',
                    difficulty: 'advanced',
                    protocol: '8 Double Front Squats, then immediately walk 20m in Rack Walk. That is one round. Do not put bells down.',
                    movements: [
                        '8 Double Front Squats',
                        '20m Farmer/Rack Carry',
                        'Do NOT put bells down between rounds.'
                    ],
                    rounds: 8
                },
                {
                    id: 'slurpees',
                    title: 'Slurpees / Bearpees',
                    desc: 'Metabolic density. Choose your poison.',
                    equipment: 'Kettlebell',
                    difficulty: 'intermediate',
                    protocol: 'Like Humane Burpee, but replace Pushups with Mtn Climbers or Bear Crawl.',
                    movements: [
                        '15 KB Swings',
                        'Goblet Squats (5, 4, 3, 2, 1)',
                        'Var: 10 Mtn Climbers OR Bear Crawl (Distance)'
                    ],
                    rounds: 5
                },
                {
                    id: 'snatch-test',
                    title: 'The Snatch Test',
                    desc: 'The gold standard of KB conditioning. 100 Reps in 5 mins.',
                    equipment: '24kg KB (Men) / 16kg (Women)',
                    difficulty: 'advanced',
                    protocol: 'Goal: Complete 100 reps in < 5 Minutes. You may switch hands and set the bell down.',
                    movements: [
                        '20 Left / 20 Right',
                        '15 Left / 15 Right',
                        '10 Left / 10 Right',
                        '5 Left / 5 Right'
                    ],
                    rounds: 1
                },
                {
                    id: 'ssst',
                    title: 'Secret Service Snatch Test',
                    desc: 'Elite work capacity test for tactical athletes.',
                    equipment: '24kg KB',
                    difficulty: 'advanced',
                    protocol: '10 Minutes MAX Reps. Switch hands as needed. Pacing is key.',
                    movements: [
                        'Max Snatch Reps in 10:00',
                        'Standard: >200 reps (Excellent)',
                        'Elite: >250 reps'
                    ],
                    rounds: 1
                },
                {
                    id: 'cardio-clean',
                    title: 'Cardio Clean Complex',
                    desc: 'Grip-intensive gasser. Active rest for the grip.',
                    equipment: 'Single KB',
                    difficulty: 'intermediate',
                    protocol: 'Perform ladder on Left, then Right. 8 Cleans/3 Squats, then 5/2, then 3/1.',
                    movements: [
                        'L: 8 Cleans / 3 Squats',
                        'R: 8 Cleans / 3 Squats',
                        'L: 5 Cleans / 2 Squats',
                        'R: 5 Cleans / 2 Squats',
                        'L: 3 Cleans / 1 Squat',
                        'R: 3 Cleans / 1 Squat'
                    ],
                    rounds: 1
                },
                 {
                    id: 'lift-n-sprint',
                    title: 'Lift-n-Sprints',
                    desc: 'Gear change drill. Teaches body to switch from heavy grind to explosive speed.',
                    equipment: 'Barbell or KB, Runner',
                    difficulty: 'intermediate',
                    protocol: 'Perform 8-10 reps of a hinge/squat, then IMMEDIATELY sprint.',
                    movements: [
                        '10 Heavy Swings or Cleans',
                        '100m Sprint (Assault Runner)',
                        'Rest 2-3 minutes'
                    ],
                    rounds: 5
                }
            ],
            hybrid: [
                {
                    id: 'abc-double',
                    title: 'Armor Building Complex',
                    desc: 'The Gold Standard. Double KB work for armor.',
                    equipment: 'Double KBs',
                    difficulty: 'intermediate',
                    protocol: '2 Cleans, 1 Press, 3 Front Squats. Advanced Goal: 30 Rounds in 30min.',
                    movements: [
                        '2 Double Cleans',
                        '1 Double Press',
                        '3 Double Front Squats'
                    ],
                    rounds: 30
                },
                {
                    id: 'abc-barbell',
                    title: 'Barbell Armor Building',
                    desc: 'The barbell adaptation of the ABC.',
                    equipment: 'Barbell',
                    difficulty: 'intermediate',
                    protocol: '2 Cleans, 1 Press, 3 Front Squats. Do not put bar down during the complex.',
                    movements: [
                        '2 Power Cleans',
                        '1 Overhead Press',
                        '3 Front Squats',
                        'Rest 1-2 min'
                    ],
                    rounds: 5
                },
                 {
                    id: 'complex-c',
                    title: 'Barbell Complex C',
                    desc: 'Explosive pulling and lower body stability.',
                    equipment: 'Barbell',
                    difficulty: 'advanced',
                    protocol: '5-8 Reps per movement. Continuous bar handling.',
                    movements: [
                        'Hang Snatch',
                        'Overhead Squat',
                        'Back Squat',
                        'Good Morning',
                        'Bent Over Row',
                        'Deadlift'
                    ],
                    rounds: 3
                },
                {
                    id: 'abc-single',
                    title: 'Single KB ABC',
                    desc: 'Asymmetry focus. Corrects imbalances.',
                    equipment: 'Single KB',
                    difficulty: 'beginner',
                    protocol: 'One "Round" is the full sequence: Left Side -> Right Side -> Squats.',
                    movements: [
                        '(Left) 1 Clean & Press',
                        '(Right) 1 Clean & Press',
                        '2 Goblet Squats',
                        '-- Park Bell / Shake Out --',
                        '(Right) 1 Clean & Press',
                        '(Left) 1 Clean & Press',
                        '2 Goblet Squats'
                    ],
                    rounds: 10
                },
                {
                    id: 'rbc',
                    title: 'Running Back Complex',
                    desc: 'Descending ladder, bells never touch ground.',
                    equipment: 'Double KBs',
                    difficulty: 'advanced',
                    protocol: 'Ladder 5 reps down to 1 rep of Cleans & Front Squats.',
                    movements: [
                        'Double Cleans (5, 4, 3, 2, 1)',
                        'Front Squats (5, 4, 3, 2, 1)',
                        'Try not to set bells down.'
                    ],
                    rounds: 5
                },
                {
                    id: 'sparhawk',
                    title: 'The Sparhawk',
                    desc: 'Goblet Squat ladder with carries. Density training.',
                    equipment: 'Single KB (32kg)',
                    difficulty: 'intermediate',
                    protocol: 'Squat ladder 8 down to 1. Perform Suitcase carry L/R between every set of squats.',
                    movements: [
                        'Goblet Squats (8, 7, 6...1)',
                        'Suitcase Carry Left (20m)',
                        'Suitcase Carry Right (20m)'
                    ],
                    rounds: 8
                },
                {
                    id: 'cook-drill',
                    title: 'The Cook Drill',
                    desc: 'Integrity under load. Created by Gray Cook.',
                    equipment: 'Single KB',
                    difficulty: 'beginner',
                    protocol: 'Walk until form breaks, then switch positions immediately.',
                    movements: [
                        'Waiter Walk (Overhead)',
                        'Rack Walk (At chest)',
                        'Suitcase Walk (At side)',
                        'Var: "CookED" add 10 swings between walks'
                    ],
                    rounds: 3
                },
                {
                    id: 'bear-bear',
                    title: 'Bear / Bear',
                    desc: 'Simple, brutal conditioning for collision sports.',
                    equipment: 'Heavy Bag or Partner',
                    difficulty: 'intermediate',
                    protocol: 'Crawl for distance, Carry for distance. Repeat.',
                    movements: [
                        'Bear Crawl (20-40m)',
                        'Bear Hug Carry (40-60m)'
                    ],
                    rounds: 5
                },
                {
                    id: 'carry-everything',
                    title: 'Loaded Carry "Everything"',
                    desc: 'The festival of carries.',
                    equipment: 'Sled, KBs, Pack',
                    difficulty: 'advanced',
                    protocol: 'Progressive loading carriage. Do one set of each.',
                    movements: [
                        'Suitcase Carry',
                        'Farmer Carry',
                        'Suitcase + Backpack',
                        'Farmer + Backpack',
                        'Sled Drag',
                        'Sled + Bearhug Carry',
                        'Sled + Backpack + Farmer'
                    ],
                    rounds: 1
                }
            ],
            tonic: [
                {
                    id: 'tonic-ruck',
                    title: 'The "Tonic" Ruck',
                    desc: 'Restorative loaded walking. Corrects posture, burns calories, spares knees. Do not run.',
                    equipment: 'Backpack + Weight',
                    difficulty: 'beginner',
                    protocol: 'Choose a Level (1-5) below. GOLDEN RULE: If you dread it, the load is too heavy. Keep HR in Zone 2 (130-140 BPM).',
                    movements: [
                        'Check Posture: Head Up, Ribs Down',
                        'Lv 1 (Recovery): Unloaded / 2.5km / 30m / 18-20min/mi',
                        'Lv 2 (Light): 10kg / 3.2km / 35m / 17-19min/mi',
                        'Lv 3 (Base): 15kg / 4.8km / 45m / 15-16.5min/mi',
                        'Lv 4 (Push): 20kg / 5.0km / 50m / 15-16min/mi',
                        'Lv 5 (Challenge): 24kg / 6.5km / 60m / <15min/mi'
                    ],
                    rounds: 1
                },
                {
                    id: 'plenty-of-nothing',
                    title: 'I Got Plenty of Nothing!',
                    desc: 'Foundational bodyweight work. Keeps the body knitted together when you have no gear.',
                    equipment: 'Floor',
                    difficulty: 'beginner',
                    protocol: 'Complete 1-3 rounds. Focus on movement quality, not speed.',
                    movements: [
                        'Push-ups or Planks: 10-20 reps',
                        'Supermans (Posterior Chain): 10 reps',
                        'Hip Thrusts / Glute Bridges: 10-20 reps',
                        'Bodyweight Squats: 10-20 reps',
                        'Ab Roll-ups: 10 slow reps',
                        'Finish: Brisk Walk (15-30 min)'
                    ],
                    rounds: 3
                },
                {
                    id: 'life-model',
                    title: 'The Life Model Template',
                    desc: 'Based on human development: crawling to rising.',
                    equipment: 'Floor',
                    difficulty: 'beginner',
                    protocol: 'Restorative session. Do not rush. Focus on smooth transitions.',
                    movements: [
                        'Naked Turkish Get-ups (5-10 min)',
                        'Half-Kneeling "Press" (Unloaded)',
                        'Bird Dogs (6-point stance)',
                        'OS: Rocks, Nods, & Rolls',
                        'Finish: More Naked TGUs'
                    ],
                    rounds: 1
                },
                {
                    id: 'humane-burpee-bw',
                    title: 'Humane Burpee (BW)',
                    desc: 'Metabolic density without external load.',
                    equipment: 'Floor',
                    difficulty: 'intermediate',
                    protocol: '15 Hinge movements, then a Squat/Push-up ladder from 10 down to 1.',
                    movements: [
                        '15 Hinge Mvmts (Get-back-ups)',
                        'Squats (10, 9, 8...1)',
                        'Push-ups (10, 9, 8...1)'
                    ],
                    rounds: 10
                },
                 {
                    id: 'os-reset',
                    title: 'OS Reset Complex',
                    desc: 'Original Strength system to reset the nervous system.',
                    equipment: 'Floor',
                    difficulty: 'beginner',
                    protocol: '20 Minutes continuous flow or as needed for recovery.',
                    movements: [
                        'Prone Neck Nods',
                        'Looking for Shoes (Head rotation)',
                        '6-Point Rocking (Tall Sternum)',
                        'Grizzly Bear Crawl',
                        'Egg Rolls (Aim for 50 reps total)'
                    ],
                    rounds: 1
                },
                {
                    id: 'floor-workout',
                    title: 'The Floor Workout',
                    desc: 'The "Greatest Secret". Getting up and down is a master skill.',
                    equipment: 'Floor',
                    difficulty: 'intermediate',
                    protocol: 'Get down, get up. Repeat. Mix in mobility work while on the floor.',
                    movements: [
                        'Get Down (Any style)',
                        'Floor Mobility (Rock/Roll/Stretch)',
                        'Get Up (Any style)',
                        'Repeat for time or reps'
                    ],
                    rounds: 20
                }
            ],
            ruck: [
                {
                    id: 'ruck-15m',
                    title: 'The Morning Reset (1.5 Miles)',
                    desc: 'Short, restorative, good for stiff mornings. 1.5 Miles / 2.5 KM.',
                    equipment: 'Ruck/Backpack',
                    difficulty: 'beginner',
                    protocol: 'Maintain a conversation pace. Green light intensity.',
                    table: [
                        { load: '10 lbs', beginner: '30:00', moderate: '25:30', advanced: '22:30' },
                        { load: '20 lbs', beginner: '30:00', moderate: '25:30', advanced: '22:30' },
                        { load: '30 lbs', beginner: '30:00', moderate: '25:30', advanced: '22:30' },
                        { load: '45 lbs', beginner: '30:00', moderate: '25:30', advanced: '22:30' }
                    ],
                    movements: ['Goal: Flush stiffness', 'Pace: 15:00-20:00 min/mile', 'Focus: Posture']
                },
                {
                    id: 'ruck-3k',
                    title: 'The Standard 3K (1.9 Miles)',
                    desc: 'Long enough to sweat, short enough to recover. Approx 1.9 Miles / 3 KM.',
                    equipment: 'Ruck/Backpack',
                    difficulty: 'intermediate',
                    protocol: 'The standard tonic distance. Zone 2 Heart Rate.',
                    table: [
                        { load: '10 lbs', beginner: '37:00', moderate: '32:00', advanced: '28:00' },
                        { load: '20 lbs', beginner: '37:00', moderate: '32:00', advanced: '28:00' },
                        { load: '30 lbs', beginner: '37:00', moderate: '32:00', advanced: '28:00' },
                        { load: '45 lbs', beginner: '37:00', moderate: '32:00', advanced: '28:00' }
                    ],
                    movements: ['Goal: Sweat & Recover', 'Pace: Steady', 'Focus: Breathing']
                },
                {
                    id: 'ruck-5k',
                    title: 'The 5K Ruck (3.1 Miles)',
                    desc: 'A solid workout. At 45lbs, this shifts from Tonic to Training.',
                    equipment: 'Ruck/Backpack',
                    difficulty: 'advanced',
                    protocol: 'Requires hydration. Monitor foot hotspots.',
                    table: [
                        { load: '10 lbs', beginner: '1h 02m', moderate: '53:00', advanced: '46:30' },
                        { load: '20 lbs', beginner: '1h 02m', moderate: '53:00', advanced: '46:30' },
                        { load: '30 lbs', beginner: '1h 02m', moderate: '53:00', advanced: '46:30' },
                        { load: '45 lbs', beginner: '1h 02m', moderate: '53:00', advanced: '46:30' }
                    ],
                    movements: ['Goal: Endurance', 'Pace: Sustainable', 'Focus: Mental Toughness']
                },
                {
                    id: 'ruck-5m',
                    title: 'The Long Haul (5 Miles)',
                    desc: 'Endurance volume. Weekend challenge.',
                    equipment: 'Ruck/Backpack',
                    difficulty: 'advanced',
                    protocol: 'MUST bring water. Ensure you have 90 mins available.',
                    table: [
                        { load: '10 lbs', beginner: '1h 40m', moderate: '1h 25m', advanced: '1h 15m' },
                        { load: '20 lbs', beginner: '1h 40m', moderate: '1h 25m', advanced: '1h 15m' },
                        { load: '30 lbs', beginner: '1h 40m', moderate: '1h 25m', advanced: '1h 15m' },
                        { load: '45 lbs', beginner: '1h 40m', moderate: '1h 25m', advanced: '1h 15m' }
                    ],
                    movements: ['Goal: Volume', 'Pace: Consistent', 'Focus: Durability']
                }
            ]
        };

        // Rebuild Pathway: 12-Week Protocol
        const REBUILD_PATHWAY = {
            overview: "A 12-week graduated return-to-play protocol. Starts with nervous system regulation and ends with full conditioning. Do not skip steps. If you finish a workout feeling 'trashed', you did too much.",
            weeks: [
                // PHASE 1: THE RESET
                { 
                    week: 1, 
                    title: 'Week 1: The Breath', 
                    context: 'Goal: Regulate the nervous system. No heavy loading.', 
                    movements: [
                        '1-Min Meditation: Count breaths', 
                        'OS: Neck Nods (1 min)', 
                        'OS: Rocking (1 min)', 
                        'Walk: 15 min Brisk Amble'
                    ] 
                },
                { 
                    week: 2, 
                    title: 'Week 2: Awakening', 
                    context: 'Goal: Reintroduce range of motion.', 
                    movements: [
                        '1-Min Meditation', 
                        'OS: Rocking + Nods', 
                        'Hang: 30 sec (supported if needed)', 
                        'Squat Hold: 30 sec (bottom pos)', 
                        'Walk: 20 min'
                    ] 
                },
                { 
                    week: 3, 
                    title: 'Week 3: Patterning', 
                    context: 'Goal: Light load to test patterns.', 
                    movements: [
                        'Daily Mobility Two (Hang/Squat)', 
                        'Goblet Squat: 1 set of 5 (Light weight)', 
                        'Suitcase Carry: 20m Left, 20m Right', 
                        'Walk: 20 min'
                    ] 
                },
                { 
                    week: 4, 
                    title: 'Week 4: The Checkpoint', 
                    context: 'Goal: Integrity. If this feels easy, move to Phase 2.', 
                    movements: [
                        'Daily Mobility Two', 
                        'Goblet Squat: 2 sets of 5', 
                        'Suitcase Carry: 40m per hand', 
                        'OS: Egg Rolls (20 reps)', 
                        'Walk: 30 min'
                    ] 
                },
                
                // PHASE 2: BUILDING BACK (Rule of 10)
                { 
                    week: 5, 
                    title: 'Week 5: Tension', 
                    context: 'Goal: Rebuild structure. 3x3 rule for tension.', 
                    movements: [
                        'Half-Kneeling Press: 3 sets of 3', 
                        'Assisted Pull-up/Hang: 3 sets of 3', 
                        'Hip Thrust: 3 sets of 10', 
                        'Suitcase Carry: Heavy (20m)'
                    ] 
                },
                { 
                    week: 6, 
                    title: 'Week 6: Stability', 
                    context: 'Goal: Maintain tension under fatigue.', 
                    movements: [
                        'Half-Kneeling Press: 3 sets of 3', 
                        'Assisted Pull-up: 3 sets of 3', 
                        'KB Swing: 3 sets of 10', 
                        'Suitcase Carry: Heavy (30m)'
                    ] 
                },
                { 
                    week: 7, 
                    title: 'Week 7: Volume', 
                    context: 'Goal: Shift to 2x5. More time under tension.', 
                    movements: [
                        'Half-Kneeling Press: 2 sets of 5', 
                        'Pull-up/Row: 2 sets of 5', 
                        'KB Swing: 2 sets of 15', 
                        'Farmer Carry (Two Hands)'
                    ] 
                },
                { 
                    week: 8, 
                    title: 'Week 8: Capacity', 
                    context: 'Goal: Test strength. Feel "Strong", not "Tired".', 
                    movements: [
                        'HK Press: 2 sets of 5 (Add load)', 
                        'Pull-up/Row: 2 sets of 5', 
                        'Goblet Squat: 2 sets of 10', 
                        'Farmer Carry: Distance'
                    ] 
                },

                // PHASE 3: THE RETURN
                { 
                    week: 9, 
                    title: 'Week 9: Integration', 
                    context: 'Goal: The "Perfect Workout" structure.', 
                    movements: [
                        '[A] 3 Rnds: Press (8) + Hang (30s)', 
                        '[B] 1 Rnd: Goblet Sq (8) + Swing (15) + Carry', 
                        'Finish: Walk'
                    ] 
                },
                { 
                    week: 10, 
                    title: 'Week 10: Density', 
                    context: 'Goal: Minimize rest in Part A.', 
                    movements: [
                        '[A] 3 Rnds: Press (8) + Hang (30s)', 
                        '[B] 1 Rnd: Goblet Sq (10) + Swing (20) + Carry', 
                        'Finish: Walk'
                    ] 
                },
                { 
                    week: 11, 
                    title: 'Week 11: Load', 
                    context: 'Goal: Heavier bell for swings/squats.', 
                    movements: [
                        '[A] 3 Rnds: Press (5 Heavy) + Hang', 
                        '[B] 1 Rnd: Goblet Sq (10) + Swing (25) + Carry', 
                        'Finish: Walk'
                    ] 
                },
                { 
                    week: 12, 
                    title: 'Week 12: Graduation', 
                    context: 'Goal: Ready for "Easy Strength".', 
                    movements: [
                        '[A] 3 Rnds: Press (5) + Pull (5)', 
                        '[B] 2 Rnds: Goblet Sq (10) + Swing (25)', 
                        'Congratulations. You are back.'
                    ] 
                }
            ]
        };

        // --- 2. STATE MANAGEMENT ---
        
        const STORAGE_KEY = 'iron-garage-v14'; // Bumped version
        
        let state = {
            currentTab: 'home', 
            activeWorkout: null,
            activeRebuildWeek: null, 
            warmupActive: false,
            checklist: {}, 
            ...loadState()
        };

        function loadState() {
            const stored = localStorage.getItem(STORAGE_KEY);
            return stored ? JSON.parse(stored) : {};
        }

        function saveState() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify({
                currentTab: state.currentTab,
                activeWorkout: state.activeWorkout,
                activeRebuildWeek: state.activeRebuildWeek,
                checklist: state.checklist
            }));
        }

        // --- 3. UI RENDERING COMPONENTS ---

        const Icons = {
            Home: '<i data-lucide="home" class="w-5 h-5"></i>',
            Dumbbell: '<i data-lucide="dumbbell" class="w-5 h-5"></i>',
            Zap: '<i data-lucide="zap" class="w-5 h-5"></i>',
            Activity: '<i data-lucide="activity" class="w-5 h-5"></i>',
            Shuffle: '<i data-lucide="shuffle" class="w-6 h-6"></i>',
            ChevronLeft: '<i data-lucide="chevron-left" class="w-6 h-6"></i>',
            Check: '<i data-lucide="check" class="w-4 h-4 text-white hidden"></i>',
            Info: '<i data-lucide="info" class="w-5 h-5"></i>',
            Leaf: '<i data-lucide="leaf" class="w-5 h-5"></i>',
            Dices: '<i data-lucide="dices" class="w-8 h-8"></i>',
            Flame: '<i data-lucide="flame" class="w-5 h-5"></i>',
            X: '<i data-lucide="x" class="w-6 h-6"></i>',
            Calendar: '<i data-lucide="calendar" class="w-5 h-5"></i>',
            DiffEasy: '<span class="inline-block w-2 h-2 rounded-full bg-emerald-500"></span>',
            DiffMed: '<span class="inline-block w-2 h-2 rounded-full bg-yellow-500"></span>',
            DiffHard: '<span class="inline-block w-2 h-2 rounded-full bg-red-600"></span>',
            Tonic: '<i data-lucide="activity" class="w-5 h-5"></i>',
            Footprints: '<i data-lucide="footprints" class="w-4 h-4"></i>'
        };

        function render() {
            const app = document.getElementById('app');
            let html = '';

            // Sticky Header
            html += `
                <div class="pt-safe-top bg-zinc-900 border-b border-zinc-800 sticky top-0 z-50">
                    <div class="h-14 flex items-center justify-between px-4">
                        ${state.activeWorkout 
                            ? `<button onclick="exitWorkout()" class="p-2 -ml-2 text-zinc-400 hover:text-white">${Icons.ChevronLeft}</button>`
                            : `<button onclick="toggleWarmup()" class="p-2 -ml-2 text-zinc-400 hover:text-red-500">${Icons.Flame}</button>` 
                        }
                        <h1 class="text-lg font-bold tracking-tight text-white uppercase italic">The Iron Garage</h1>
                        <button onclick="showInventory()" class="p-2 -mr-2 text-zinc-400 hover:text-white">${Icons.Info}</button>
                    </div>
                </div>
            `;

            // Content
            html += `<div class="flex-1 overflow-y-auto overflow-x-hidden hide-scrollbar pb-safe-bottom bg-zinc-950 relative">`;

            if (state.warmupActive) {
                html += renderWarmup();
            } else if (state.activeWorkout) {
                html += renderActiveWorkout();
            } else {
                html += renderDashboard();
            }

            html += `</div>`;
            app.innerHTML = html;
            lucide.createIcons();
        }

        function renderWarmup() {
            return `
                <div class="p-6 space-y-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-black text-white uppercase">Daily Warm-up</h2>
                        <button onclick="toggleWarmup()" class="text-zinc-400 hover:text-white">${Icons.X}</button>
                    </div>
                    <div class="space-y-4">
                        <div class="text-sm text-zinc-500 font-mono mb-2 uppercase tracking-widest">The 5 Steps</div>
                        ${WARMUP_ROUTINE.map((step, idx) => `
                            <div class="bg-zinc-900 border border-zinc-800 p-4 rounded-xl">
                                <h3 class="text-red-500 font-bold uppercase text-sm mb-1">${step.title}</h3>
                                <p class="text-zinc-300 text-sm leading-snug">${step.desc}</p>
                            </div>
                        `).join('')}
                    </div>
                    <button onclick="toggleWarmup()" class="w-full bg-zinc-100 text-zinc-900 font-bold py-4 rounded-xl mt-8">Ready to Lift</button>
                </div>
            `;
        }

        function renderDashboard() {
            let navHtml = `
                <div class="flex border-b border-zinc-800 bg-zinc-900 sticky top-0 z-40 overflow-x-auto hide-scrollbar">
                     <button onclick="switchTab('home')" class="flex-1 min-w-[70px] py-4 flex justify-center ${state.currentTab === 'home' ? 'tab-active' : 'tab-inactive'}">${Icons.Home}</button>
                    <button onclick="switchTab('grind')" class="flex-1 min-w-[80px] py-4 text-xs font-bold uppercase tracking-wider text-center ${state.currentTab === 'grind' ? 'tab-active' : 'tab-inactive'}">Grind</button>
                    <button onclick="switchTab('ballistic')" class="flex-1 min-w-[80px] py-4 text-xs font-bold uppercase tracking-wider text-center ${state.currentTab === 'ballistic' ? 'tab-active' : 'tab-inactive'}">Ballistic</button>
                    <button onclick="switchTab('hybrid')" class="flex-1 min-w-[80px] py-4 text-xs font-bold uppercase tracking-wider text-center ${state.currentTab === 'hybrid' ? 'tab-active' : 'tab-inactive'}">Hybrid</button>
                    <button onclick="switchTab('tonic')" class="flex-1 min-w-[80px] py-4 text-xs font-bold uppercase tracking-wider text-center ${state.currentTab === 'tonic' ? 'tab-active-tonic' : 'tab-inactive'}">Tonic</button>
                     <button onclick="switchTab('ruck')" class="flex-1 min-w-[80px] py-4 text-xs font-bold uppercase tracking-wider text-center ${state.currentTab === 'ruck' ? 'tab-active-ruck' : 'tab-inactive'}">Ruck</button>
                    <button onclick="switchTab('rebuild')" class="flex-1 min-w-[80px] py-4 text-xs font-bold uppercase tracking-wider text-center ${state.currentTab === 'rebuild' ? 'tab-active-rebuild' : 'tab-inactive'}">Rebuild</button>
                </div>
            `;

            if (state.currentTab === 'home') return navHtml + renderHome();
            if (state.currentTab === 'rebuild') return navHtml + renderRebuildHub();
            
            // Ruck Tab Specific
            if (state.currentTab === 'ruck') {
                let ruckHtml = `
                    <div class="p-4 space-y-4">
                        <div class="bg-zinc-900 border border-amber-900/30 p-5 rounded-2xl">
                             <h2 class="text-xl font-bold text-white mb-3 flex items-center gap-2">
                                <span class="text-amber-500">${Icons.Footprints}</span>
                                Mission Brief
                            </h2>
                            <div class="space-y-4 text-sm text-zinc-400">
                                <div>
                                    <strong class="text-zinc-200 block mb-1">Equipment & Setup</strong>
                                    Use a pack with thick straps and a sternum strap. Wrap weight (KB/Dumbbell) in a towel and position it high in the pack (between shoulder blades). Cinch tight.
                                </div>
                                 <div>
                                    <strong class="text-zinc-200 block mb-1">Dan John's Rules</strong>
                                    <ul class="list-disc pl-4 space-y-1">
                                        <li><strong>Don't Run:</strong> Add weight, not speed.</li>
                                        <li><strong>Posture First:</strong> Head up, ribs down. Shoulders back.</li>
                                        <li><strong>The Talk Test:</strong> You should be able to speak in full sentences.</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                         <div class="text-xs font-semibold text-zinc-500 uppercase tracking-wider mb-2">Distance Protocols</div>
                        ${WORKOUTS['ruck'].map(w => `
                             <div onclick="selectWorkout('${w.id}')" class="bg-zinc-900 border border-zinc-800 rounded-xl p-4 active:bg-zinc-800 transition-colors cursor-pointer relative overflow-hidden group hover:border-amber-700/50">
                                <div class="absolute top-0 right-0 p-2">
                                    ${getDifficultyIcon(w.difficulty)}
                                </div>
                                <div class="flex justify-between items-start mb-1 pr-6">
                                    <h3 class="text-white font-bold text-lg group-hover:text-amber-500 transition-colors">${w.title}</h3>
                                </div>
                                <p class="text-zinc-400 text-sm leading-snug mb-3">${w.desc}</p>
                                <div class="flex items-center gap-2 text-xs text-zinc-500">
                                    ${Icons.Footprints}
                                    <span>${w.equipment}</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
                return navHtml + ruckHtml;
            }

            let listHtml = `
                <!-- Randomizer FAB (Excluded from Tonic/Ruck/Rebuild) -->
                ${(state.currentTab !== 'tonic' && state.currentTab !== 'ruck') ? `
                <div class="px-4 pt-6 pb-2">
                    <button onclick="randomizeInTab('${state.currentTab}')" class="w-full bg-gradient-to-r from-red-600 to-red-700 active:from-red-700 active:to-red-800 text-white rounded-xl py-4 shadow-lg shadow-red-900/20 flex items-center justify-center gap-2 transition-transform active:scale-[0.98]">
                        ${Icons.Shuffle}
                        <span class="font-bold uppercase tracking-wide">Roll the Dice: ${state.currentTab}</span>
                    </button>
                </div>
                ` : `<div class="px-4 pt-6"><div class="bg-blue-900/20 border border-blue-900/50 p-3 rounded-lg text-blue-400 text-xs text-center">Restorative sessions. Choose deliberately.</div></div>`}

                <!-- Workout List -->
                <div class="p-4 space-y-3">
                    <div class="text-xs font-semibold text-zinc-500 uppercase tracking-wider mb-2">Available Protocols</div>
                    ${WORKOUTS[state.currentTab].map(w => `
                        <div onclick="selectWorkout('${w.id}')" class="bg-zinc-900 border border-zinc-800 rounded-xl p-4 active:bg-zinc-800 transition-colors cursor-pointer relative overflow-hidden">
                            <div class="absolute top-0 right-0 p-2">
                                ${getDifficultyIcon(w.difficulty)}
                            </div>
                            <div class="flex justify-between items-start mb-1 pr-6">
                                <h3 class="text-white font-bold text-lg">${w.title}</h3>
                            </div>
                             <div class="mb-2">
                                <span class="text-xs bg-zinc-800 text-zinc-400 px-2 py-0.5 rounded border border-zinc-700">${w.rounds > 1 ? w.rounds + ' Rnds' : 'Checklist'}</span>
                            </div>
                            <p class="text-zinc-400 text-sm leading-snug mb-3">${w.desc}</p>
                            <div class="flex items-center gap-2 text-xs text-zinc-500">
                                ${getIconForTab(state.currentTab)}
                                <span>${w.equipment}</span>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            return navHtml + listHtml;
        }

        function renderRebuildHub() {
            if (state.activeRebuildWeek !== null) {
                const weekData = REBUILD_PATHWAY.weeks.find(w => w.week === state.activeRebuildWeek);
                return `
                    <div class="p-6">
                         <button onclick="clearRebuildWeek()" class="flex items-center text-emerald-500 text-sm font-bold mb-4">
                            ${Icons.ChevronLeft} Back to Roadmap
                        </button>
                        
                        <div class="bg-zinc-900 border border-emerald-900/30 p-6 rounded-2xl mb-6 shadow-lg shadow-emerald-900/10">
                            <div class="flex items-center gap-3 mb-4">
                                <div class="p-2 bg-emerald-900/20 text-emerald-500 rounded-lg">${Icons.Calendar}</div>
                                <div>
                                    <h2 class="text-xl font-bold text-white">${weekData.title}</h2>
                                    <p class="text-xs text-emerald-400 font-mono uppercase">Rebuild Phase</p>
                                </div>
                            </div>
                            <div class="mb-4">
                                <h4 class="text-xs font-bold text-zinc-500 uppercase tracking-wider mb-2">Context</h4>
                                <p class="text-zinc-300 text-sm leading-relaxed">${weekData.context}</p>
                            </div>
                        </div>

                        <div class="space-y-4">
                             <div class="text-xs font-semibold text-zinc-500 uppercase tracking-wider">Prescribed Protocol</div>
                             <div class="bg-zinc-900 border border-zinc-800 rounded-xl p-4">
                                <ul class="space-y-3">
                                    ${weekData.movements.map(m => `
                                        <li class="flex items-start gap-3 text-zinc-200 text-sm">
                                            <span class="w-1.5 h-1.5 rounded-full bg-emerald-500 mt-2 shrink-0"></span>
                                            <span class="leading-relaxed">${m}</span>
                                        </li>
                                    `).join('')}
                                </ul>
                                <div class="mt-6 pt-4 border-t border-zinc-800">
                                    <button onclick="startRebuildSession(${state.activeRebuildWeek})" class="w-full py-3 bg-emerald-600 hover:bg-emerald-500 text-white font-bold rounded-lg uppercase tracking-wide text-sm">
                                        Start Session
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            return `
                <div class="p-6 space-y-6">
                    <div class="bg-zinc-900 p-5 rounded-2xl border border-zinc-800">
                        <h2 class="text-xl font-bold text-white mb-2 flex items-center gap-2">
                            <span class="text-emerald-500">${Icons.Leaf}</span>
                            Mission Brief
                        </h2>
                        <p class="text-zinc-400 text-sm leading-relaxed">
                            ${REBUILD_PATHWAY.overview}
                        </p>
                    </div>

                    <div class="space-y-6">
                        <!-- Phase 1 -->
                        <div>
                            <div class="text-xs font-bold text-emerald-500 uppercase tracking-widest mb-3 pl-1">Phase 1: The Reset</div>
                            <div class="grid grid-cols-4 gap-2">
                                ${[1,2,3,4].map(wk => `
                                    <button onclick="setRebuildWeek(${wk})" class="aspect-square bg-zinc-900 border border-zinc-800 rounded-xl flex flex-col items-center justify-center hover:border-emerald-500 hover:bg-zinc-800 transition-all">
                                        <span class="text-[10px] text-zinc-500 uppercase">Wk</span>
                                        <span class="text-xl font-bold text-white">${wk}</span>
                                    </button>
                                `).join('')}
                            </div>
                        </div>

                        <!-- Phase 2 -->
                         <div>
                            <div class="text-xs font-bold text-emerald-500 uppercase tracking-widest mb-3 pl-1">Phase 2: Building Back</div>
                            <div class="grid grid-cols-4 gap-2">
                                ${[5,6,7,8].map(wk => `
                                    <button onclick="setRebuildWeek(${wk})" class="aspect-square bg-zinc-900 border border-zinc-800 rounded-xl flex flex-col items-center justify-center hover:border-emerald-500 hover:bg-zinc-800 transition-all">
                                        <span class="text-[10px] text-zinc-500 uppercase">Wk</span>
                                        <span class="text-xl font-bold text-white">${wk}</span>
                                    </button>
                                `).join('')}
                            </div>
                        </div>

                        <!-- Phase 3 -->
                         <div>
                            <div class="text-xs font-bold text-emerald-500 uppercase tracking-widest mb-3 pl-1">Phase 3: The Return</div>
                            <div class="grid grid-cols-4 gap-2">
                                ${[9,10,11,12].map(wk => `
                                    <button onclick="setRebuildWeek(${wk})" class="aspect-square bg-zinc-900 border border-zinc-800 rounded-xl flex flex-col items-center justify-center hover:border-emerald-500 hover:bg-zinc-800 transition-all">
                                        <span class="text-[10px] text-zinc-500 uppercase">Wk</span>
                                        <span class="text-xl font-bold text-white">${wk}</span>
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderHome() {
            return `
                <div class="p-6 flex flex-col gap-6 min-h-[80vh]">
                    <div class="bg-zinc-900 border border-zinc-800 rounded-2xl p-8 flex flex-col items-center text-center space-y-5 shadow-xl shadow-black/50 mt-4">
                        <div class="bg-red-900/10 p-5 rounded-full border border-red-900/30 text-red-500 ring-1 ring-red-900/20">${Icons.Dices}</div>
                        <div class="space-y-1">
                            <h2 class="text-2xl font-black text-white uppercase italic tracking-tight">Garage Roulette</h2>
                            <p class="text-zinc-500 text-sm font-medium">Let the garage gods decide your fate.</p>
                        </div>
                        <button onclick="randomizeGlobal()" class="w-full bg-red-600 hover:bg-red-500 text-white font-bold py-4 rounded-xl uppercase tracking-wider transition-all active:scale-[0.98] shadow-lg shadow-red-900/40 text-sm flex items-center justify-center gap-2">
                            ${Icons.Shuffle} Randomize All
                        </button>
                        <div class="text-[10px] text-zinc-600 font-mono mt-4">Build: ${APP_BUILD_DATE}</div>
                        <div class="text-[9px] text-zinc-700 mt-1">Based on the works of Dan John</div>
                    </div>
                    
                    <div class="space-y-3 mt-2">
                        <h3 class="text-xs font-bold text-zinc-600 uppercase tracking-wider ml-1">Quick Access</h3>
                        <div class="grid grid-cols-2 gap-3">
                            <button onclick="switchTab('grind')" class="bg-zinc-900 p-4 rounded-xl border border-zinc-800 text-left hover:border-zinc-700 hover:bg-zinc-800 transition-all group">
                                <span class="block text-zinc-500 mb-2 group-hover:text-red-500 transition-colors">${Icons.Dumbbell}</span>
                                <span class="font-bold text-zinc-200 block text-sm uppercase">Grind</span>
                                <span class="text-xs text-zinc-600">Strength Focus</span>
                            </button>
                            <button onclick="switchTab('ballistic')" class="bg-zinc-900 p-4 rounded-xl border border-zinc-800 text-left hover:border-zinc-700 hover:bg-zinc-800 transition-all group">
                                <span class="block text-zinc-500 mb-2 group-hover:text-red-500 transition-colors">${Icons.Zap}</span>
                                <span class="font-bold text-zinc-200 block text-sm uppercase">Ballistic</span>
                                <span class="text-xs text-zinc-600">Conditioning</span>
                            </button>
                            <button onclick="switchTab('hybrid')" class="bg-zinc-900 p-4 rounded-xl border border-zinc-800 text-left hover:border-zinc-700 hover:bg-zinc-800 transition-all group">
                                <span class="block text-zinc-500 mb-2 group-hover:text-red-500 transition-colors">${Icons.Activity}</span>
                                <span class="font-bold text-zinc-200 block text-sm uppercase">Hybrid</span>
                                <span class="text-xs text-zinc-600">The Mix</span>
                            </button>
                            <button onclick="switchTab('tonic')" class="bg-zinc-900 p-4 rounded-xl border border-zinc-800 text-left hover:border-blue-700 hover:bg-zinc-800 transition-all group">
                                <span class="block text-zinc-500 mb-2 group-hover:text-blue-500 transition-colors">${Icons.Tonic}</span>
                                <span class="font-bold text-zinc-200 block text-sm uppercase">Tonic</span>
                                <span class="text-xs text-zinc-600">Bodyweight/Reset</span>
                            </button>
                             <button onclick="switchTab('ruck')" class="bg-zinc-900 p-4 rounded-xl border border-zinc-800 text-left hover:border-amber-700 hover:bg-zinc-800 transition-all group">
                                <span class="block text-zinc-500 mb-2 group-hover:text-amber-500 transition-colors">${Icons.Footprints}</span>
                                <span class="font-bold text-zinc-200 block text-sm uppercase">Rucking</span>
                                <span class="text-xs text-zinc-600">Cardio for Lifters</span>
                            </button>
                             <!-- Rebuild  -->
                            <button onclick="switchTab('rebuild')" class="bg-zinc-900 p-4 rounded-xl border border-zinc-800 text-left hover:border-emerald-700 hover:bg-zinc-800 transition-all group">
                                <span class="block text-zinc-500 mb-2 group-hover:text-emerald-500 transition-colors">${Icons.Leaf}</span>
                                <span class="font-bold text-zinc-200 block text-sm uppercase">Rebuild</span>
                                <span class="text-xs text-zinc-600">Return to Play</span>
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderActiveWorkout() {
            const w = state.activeWorkout;
            const progress = calculateProgress();
            
            let category = getWorkoutCategory(w.id);
            let themeColor = 'bg-red-900/30 text-red-500 border-red-900/50';
            let checkColor = 'checkbox-wrapper';
            
            if (category === 'Rebuild') {
                 themeColor = 'bg-emerald-900/30 text-emerald-500 border-emerald-900/50';
                 checkColor = 'checkbox-wrapper-rebuild';
            } else if (category === 'Tonic') {
                 themeColor = 'bg-blue-900/30 text-blue-500 border-blue-900/50';
                 checkColor = 'checkbox-wrapper-tonic';
            } else if (category === 'Ruck') {
                 themeColor = 'bg-amber-900/30 text-amber-500 border-amber-900/50';
                 checkColor = 'checkbox-wrapper-ruck';
            }
            
            return `
                <div class="min-h-full pb-20">
                    <div class="px-6 pt-8 pb-6 bg-zinc-900 border-b border-zinc-800">
                        <div class="flex justify-between items-start mb-3">
                            <div class="inline-block px-2 py-1 rounded ${themeColor} text-xs font-bold uppercase tracking-wider border">
                                ${category}
                            </div>
                            ${w.difficulty ? `
                            <div class="bg-zinc-800 px-2 py-1 rounded border border-zinc-700 text-xs text-zinc-300 capitalize flex items-center gap-1">
                                ${getDifficultyIcon(w.difficulty)} ${w.difficulty}
                            </div>` : ''}
                        </div>
                        <h2 class="text-3xl font-black text-white mb-2 leading-none">${w.title}</h2>
                        <p class="text-zinc-400 text-sm">${w.desc}</p>
                    </div>

                    <div class="p-6 space-y-6">
                        ${w.equipment ? `
                        <div class="bg-zinc-900/50 rounded-lg p-4 border border-zinc-800">
                            <h4 class="text-xs font-bold text-zinc-500 uppercase tracking-wider mb-2">Gear Required</h4>
                            <p class="text-zinc-300 text-sm font-medium">${w.equipment}</p>
                        </div>` : ''}
                        
                        <!-- Ruck Table Logic -->
                        ${w.table ? `
                        <div class="bg-zinc-900/50 rounded-lg p-4 border border-zinc-800 overflow-x-auto">
                            <h4 class="text-xs font-bold text-zinc-500 uppercase tracking-wider mb-2">Pace Targets</h4>
                            <table class="w-full text-left text-sm text-zinc-300">
                                <thead>
                                    <tr class="border-b border-zinc-700">
                                        <th class="py-2">Load</th>
                                        <th class="py-2">Beginner</th>
                                        <th class="py-2">Moderate</th>
                                        <th class="py-2">Advanced</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${w.table.map(row => `
                                        <tr class="border-b border-zinc-800 last:border-0">
                                            <td class="py-2 font-bold text-white">${row.load}</td>
                                            <td class="py-2 text-emerald-500">${row.beginner}</td>
                                            <td class="py-2 text-yellow-500">${row.moderate}</td>
                                            <td class="py-2 text-red-500">${row.advanced}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                        ` : ''}

                         <div class="bg-zinc-900/50 rounded-lg p-4 border border-zinc-800">
                            <h4 class="text-xs font-bold text-zinc-500 uppercase tracking-wider mb-2">The Work</h4>
                            ${w.protocol ? `<p class="text-zinc-300 text-sm mb-3 italic">"${w.protocol}"</p>` : ''}
                            <ul class="space-y-2">
                                ${w.movements.map(m => `
                                    <li class="flex items-start gap-3 text-zinc-300 text-sm">
                                        <span class="w-1.5 h-1.5 rounded-full ${category === 'Rebuild' ? 'bg-emerald-500' : (category === 'Tonic' ? 'bg-blue-500' : (category === 'Ruck' ? 'bg-amber-500' : 'bg-red-600'))} mt-2 shrink-0"></span>
                                        <span class="leading-relaxed">${m}</span>
                                    </li>
                                `).join('')}
                            </ul>
                        </div>

                        <div>
                             <div class="flex justify-between items-end mb-4">
                                <h4 class="text-sm font-bold text-white uppercase tracking-wider">Round Tracker</h4>
                                <span class="text-xs text-zinc-500 font-mono">${progress}% Complete</span>
                            </div>
                            
                            <div class="grid grid-cols-5 gap-2">
                                ${Array.from({length: w.rounds}).map((_, i) => `
                                    <label class="${checkColor} cursor-pointer relative">
                                        <input type="checkbox" class="opacity-0 absolute w-full h-full z-10" 
                                            ${state.checklist[i] ? 'checked' : ''} 
                                            onchange="toggleRound(${i})">
                                        <div class="h-12 rounded bg-zinc-800 border-2 border-zinc-700 flex items-center justify-center transition-all duration-200">
                                            <span class="text-sm font-bold text-zinc-500 ${state.checklist[i] ? 'hidden' : 'block'}">${i + 1}</span>
                                            ${Icons.Check}
                                        </div>
                                    </label>
                                `).join('')}
                                <button onclick="addRound()" class="h-12 rounded bg-zinc-900 border border-dashed border-zinc-700 flex items-center justify-center text-zinc-500 hover:text-white hover:border-zinc-500 active:scale-95 transition-all"><span class="text-xl font-bold">+</span></button>
                            </div>
                        </div>
                        
                        <div class="pt-8">
                             <button onclick="completeWorkout()" class="w-full py-4 bg-zinc-100 text-zinc-900 font-bold uppercase rounded-xl active:scale-[0.98] transition-transform">Finish Session</button>
                        </div>
                    </div>
                </div>
            `;
        }

        // --- 4. LOGIC ---

        function switchTab(tab) { state.currentTab = tab; saveState(); render(); }
        function toggleWarmup() { state.warmupActive = !state.warmupActive; render(); }
        
        function getWorkoutCategory(id) {
            // Check standard workouts
            for (const [cat, list] of Object.entries(WORKOUTS)) {
                if (list.find(w => w.id === id)) return cat.charAt(0).toUpperCase() + cat.slice(1);
            }
            // Check rebuild
            if(id.startsWith('rebuild-week-')) return 'Rebuild';
            
            return 'Unknown';
        }
        
        function getIconForTab(tab) {
            if (tab === 'grind') return Icons.Dumbbell;
            if (tab === 'ballistic') return Icons.Zap;
            if (tab === 'hybrid') return Icons.Activity;
            if (tab === 'rebuild') return Icons.Leaf;
            if (tab === 'tonic') return Icons.Tonic;
            if (tab === 'ruck') return Icons.Footprints;
            return Icons.Dumbbell;
        }

        function getDifficultyIcon(diff) {
            if (diff === 'beginner') return Icons.DiffEasy;
            if (diff === 'intermediate') return Icons.DiffMed;
            if (diff === 'advanced') return Icons.DiffHard;
            return '';
        }

        // --- Rebuild Specific Logic ---
        function setRebuildWeek(weekNum) {
            state.activeRebuildWeek = weekNum;
            saveState();
            render();
        }
        
        function clearRebuildWeek() {
            state.activeRebuildWeek = null;
            saveState();
            render();
        }
        
        function startRebuildSession(weekNum) {
            const weekData = REBUILD_PATHWAY.weeks.find(w => w.week === weekNum);
            
            const tempWorkout = {
                id: `rebuild-week-${weekNum}`,
                title: weekData.title,
                desc: weekData.context,
                protocol: 'Complete all movements in order.',
                equipment: 'Bodyweight / Light KB',
                movements: weekData.movements,
                rounds: 1,
                difficulty: 'beginner'
            };

            state.activeWorkout = tempWorkout;
            state.checklist = {};
            saveState();
            render();
        }

        function selectWorkout(id) {
            let workout = null;
            for (const list of Object.values(WORKOUTS)) {
                const found = list.find(w => w.id === id);
                if (found) { workout = found; break; }
            }
            if (workout) {
                state.activeWorkout = workout;
                state.checklist = {}; 
                state.warmupActive = false;
                saveState();
                render();
            }
        }

        function randomizeInTab(tab) {
            const list = WORKOUTS[tab];
            const random = list[Math.floor(Math.random() * list.length)];
            selectWorkout(random.id);
        }

        function randomizeGlobal() {
            // Flatten ONLY the standard workouts, explicitly excluding Rebuild/Tonic/Ruck
            const allowedLists = [WORKOUTS.grind, WORKOUTS.ballistic, WORKOUTS.hybrid];
            const allWorkouts = allowedLists.flat();
            const random = allWorkouts[Math.floor(Math.random() * allWorkouts.length)];
            selectWorkout(random.id);
        }

        function toggleRound(index) { state.checklist[index] = !state.checklist[index]; saveState(); render(); }
        function addRound() { if(state.activeWorkout) { state.activeWorkout.rounds += 1; saveState(); render(); } }
        
        function calculateProgress() {
            const total = state.activeWorkout.rounds;
            const completed = Object.values(state.checklist).filter(Boolean).length;
            return Math.round((completed / total) * 100);
        }

        function completeWorkout() { if (confirm('Finish workout?')) { exitWorkout(); } }
        function exitWorkout() { state.activeWorkout = null; state.checklist = {}; saveState(); render(); }
        
        function showInventory() {
            const invText = `INVENTORY:\n KBs (Pairs): ${INVENTORY.kbs.pairs.join('kg, ')}kg\n KBs (Singles): ${INVENTORY.kbs.singles.join('kg, ')}kg\n Barbell\n ${INVENTORY.machines.join('\n ')}`;
            alert(invText);
        }

        render();
    </script>
</body>
</html>


